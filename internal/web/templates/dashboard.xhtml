{{define "title"}}Dashboard{{end}}
{{define "head"}}<meta http-equiv="refresh" content="30" />{{end}}
{{define "content"}}
<h1>Dashboard</h1>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-label">Throughput</div>
    <div class="stat-value">{{.BPS}}</div>
    <div class="stat-sub">{{.PPS}}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Total Bytes</div>
    <div class="stat-value">{{formatBytes .TotalBytes}}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Total Packets</div>
    <div class="stat-value">{{formatPkts .TotalPackets}}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Flows ({{.Window}})</div>
    <div class="stat-value">{{.FlowCount}}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Active Flows (last 60s)</div>
    <div class="stat-value">{{.ActiveFlows}}</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Active Hosts</div>
    <div class="stat-value"><a href="/hosts">{{.ActiveHosts}}</a></div>
  </div>
</div>

<div class="two-col">
  <div class="panel">
    <h2>Top Sources</h2>
    {{if .TopSrc}}
    <table>
      <thead>
        <tr><th>Source IP</th><th>Bytes</th><th>Packets</th><th>%</th></tr>
      </thead>
      <tbody>
        {{range .TopSrc}}
        <tr>
          <td><a href="/flows?src_ip={{.IP}}">{{.IP}}</a></td>
          <td>{{formatBytes .Bytes}}</td>
          <td>{{formatPkts .Packets}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>

  <div class="panel">
    <h2>Top Destinations</h2>
    {{if .TopDst}}
    <table>
      <thead>
        <tr><th>Destination IP</th><th>Bytes</th><th>Packets</th><th>%</th></tr>
      </thead>
      <tbody>
        {{range .TopDst}}
        <tr>
          <td><a href="/flows?dst_ip={{.IP}}">{{.IP}}</a></td>
          <td>{{formatBytes .Bytes}}</td>
          <td>{{formatPkts .Packets}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>
</div>

<div class="two-col">
  <div class="panel">
    <h2>L7 Application Protocols</h2>
    {{if .AppProtocols}}
    <table>
      <thead>
        <tr><th>Application</th><th>Bytes</th><th>Flows</th><th>Share</th></tr>
      </thead>
      <tbody>
        {{range .AppProtocols}}
        <tr>
          <td>{{.Name}}</td>
          <td>{{formatBytes .Bytes}}</td>
          <td>{{.Flows}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill app" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>

  <div class="panel">
    <h2>Traffic Categories</h2>
    {{if .Categories}}
    <table>
      <thead>
        <tr><th>Category</th><th>Bytes</th><th>Flows</th><th>Share</th></tr>
      </thead>
      <tbody>
        {{range .Categories}}
        <tr>
          <td>{{.Name}}</td>
          <td>{{formatBytes .Bytes}}</td>
          <td>{{.Flows}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill cat" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>
</div>

<div class="two-col">
  <div class="panel">
    <h2>Protocol Breakdown</h2>
    {{if .Protocols}}
    <table>
      <thead>
        <tr><th>Protocol</th><th>Bytes</th><th>Packets</th><th>Share</th></tr>
      </thead>
      <tbody>
        {{range .Protocols}}
        <tr>
          <td>{{.Name}}</td>
          <td>{{formatBytes .Bytes}}</td>
          <td>{{formatPkts .Packets}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill proto" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>

  <div class="panel">
    <h2>Top Autonomous Systems</h2>
    {{if .TopAS}}
    <table>
      <thead>
        <tr><th>AS</th><th>Organisation</th><th>Bytes</th><th>Share</th></tr>
      </thead>
      <tbody>
        {{range .TopAS}}
        <tr>
          <td>{{if .ASN}}AS{{.ASN}}{{else}}â€”{{end}}</td>
          <td>{{.Name}}</td>
          <td>{{formatBytes .Bytes}}</td>
          <td>
            <div class="bar-bg"><div class="bar-fill as" style="width:{{.Pct}}%"></div></div>
            {{.Pct}}%
          </td>
        </tr>
        {{end}}
      </tbody>
    </table>
    {{else}}
    <p class="empty">No flow data yet.</p>
    {{end}}
  </div>
</div>
{{end}}
